<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–∫–∞–Ω–µ—Ä –∫–∞—Ä—Ç QR</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 1em;
    }
    h2 {
      font-size: 1.5em;
      margin-bottom: 1em;
    }
    #reader {
      width: 90%;
      max-width: 500px;
      margin: auto;
      border: 1px solid #ccc;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    #reader__dashboard_section_csr span {
      font-size: 1.2em;
    }
    #reader__dashboard_section_csr select {
      font-size: 1.2em;
      padding: 5px;
    }
    #result {
      margin-top: 1.5em;
      font-size: 1.3em;
      font-weight: bold;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <h2>üì∑ –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥</h2>
  <div id="reader"></div>
  <div id="result">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...</div>

  <script>
    function onScanSuccess(decodedText, decodedResult) {
      console.log(`Code matched = ${decodedText}`, decodedResult);
      document.getElementById("result").innerText = "–ù–∞–π–¥–µ–Ω –∫–æ–¥: " + decodedText;
      html5QrcodeScanner.clear();

      const baseDeepLink = window.location.hash.substring(1);

      if (baseDeepLink && baseDeepLink.includes("t.me")) {
        const finalDeepLink = baseDeepLink + decodedText;
        console.log(`Redirecting to: ${finalDeepLink}`);
        
        document.getElementById("result").innerText = "–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ Telegram...";
        window.location.href = finalDeepLink;
      } else {
        console.error("Base deep link not found or invalid in URL hash!");
        document.getElementById("result").innerText = "–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –±–æ—Ç.";
      }
    }

    function onScanFailure(error) {
    }

    const html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", 
      { 
        fps: 10, 
        qrbox: { width: 250, height: 250 },
        facingMode: "environment" 
      }, 
      false);
      
    html5QrcodeScanner.render(onScanSuccess, onScanFailure);
  </script>
</body>
</html>
